---
title: "Modelling the sub-epithelial stroma in the intestine"
author: "Axel Almet"
date: "`r format(Sys.time(), '%d %B, %Y')`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(cowplot)
library(R.matlab)
library(latex2exp)
library(RColorBrewer)
library(ggpubr)
library(plotly)
library(tikzDevice)
```

# Generalised-set up
We model the crypt as a planar, growing, inextensible elastic rod attached to an underlying foundation $\mathbf{f} = f\mathbf{e}_x + g\mathbf{e}_y$, the choice of which we will explore. Tissue growth is encapsulated by the growth stretch $\gamma$, modelling a local increase of the initial arc length $S_0$; that is, 
\begin{align}
\gamma = \frac{\partial s}{\partial S_0}.
\end{align}
The equations describing geometric constraints and balance of linear and angular momentum are given by:
\begin{align}
&x' = \gamma\cos\theta,\\
&y' = \gamma\sin\theta,\\
&n_x' + \gamma f = 0,\\
&n_y' + \gamma g = 0,\\
&\theta' = E_b\gamma m,\\
&m' = \gamma(n_x\sin\theta - n_y\cos\theta).
\end{align}
For simplicity, we assume the rod is clamped horizontally at the boundaries:
\begin{align}
x(0) = 0, \qquad x(1) = 0, \qquad y(0) = y(1) =  y_0, \qquad \theta(0) = \theta(1) = 0.
\end{align}

The parameter $L_0$ is the initial rod length, giving the horizontal interval of deformation for the crypt. 

# What is the most appropriate foundation law?

Attached directly underneath the intestinal epithelium is the basement membrane, a thin, fibrous network of extracellular proteins. The basement membrane provides an anchoring on which the epithelial cells can migrate, as well as facilitating epithelial-mesenchymal communication. Underneath the basement membrane sits the lamina propria, a heterogeneous composition of mesenchymal cells. The lamina propria provides structural support between crypts, and also has been shown in recent years to provide extrinsic growth and differentiation factors, for example, the non-canonical Wnt5a and Bone Morphogenetic Proteins (BMPs) such as Grem1. 

Mechanically, it is unclear what the best description for the basement membrane and stroma should be, in terms of the underlying rod foundation.  In continuum models of the crypt, the basement membrane and stroma are often modelled by a constitutive law describing the bulk behaviour of the underlying attachments to the epithelium (Edwards and Chapman, 2007; Nelson et al., 2011; Nelson et al., 2013), although models that describe both explicitly do exist (Hannezo et al., 2011). 

All foundations in this framework are modelled in the same manner. We the attachment of the rod centreline $\mathbf{r} = (x, y)$ to the (initial) foundation line $\pmb{\rho} = (p_x, p_y)$ as such:
\begin{align}
\mathbf{f} = \frac{\sigma}{\Delta}(\pmb{\rho} - \mathbf{r}) = \frac{\sigma}{\Delta}\left[(p_x - x)\mathbf{e}_x + (p_y - y)\mathbf{e}_y\right],
\end{align}
where $\Delta = \|\pmb{\rho} - \mathbf{r}\|$ measures the total strain undergone by the rod. The mechanical evolution of the foundation is thus described completely by the stress parameter $\sigma$ and the foundation shape $\pmb{\rho}$.

### Elastic foundation
The simplest choice for the underlying stroma is that of an elastic foundation, as used by Hannezo et al. (2011). A generalised elastic foundation description is given by
\begin{align}
\sigma = \gamma^{-1}h(\Delta), \qquad \pmb{\rho} = (S_0, 0).
\end{align}
Note the presence of the factor of $\gamma^{-1}$ to account for the absence of remodelling of the foundation. In the linear elastic case, we have $h(\Delta) \approx k\gamma^{-1}\Delta$, where $k$ represents the foundation stiffness. Consequently, the force balance equations are given by
\begin{align}
n_x' = k(x - S_0), \qquad n_y' = ky.
\end{align}

### Linear viscoelastic
We model linear viscoelasticity using a standard linear solid model, which captures aspects of the simpler Kelvin-Voigt and Maxwell models. The model is constructed by attaching a linear, elastic spring with stiffness $E_1$ in parallel to a Maxwell unit with spring stiffness $E_2$ and viscosity $\eta$. The dimensional form of the constitutive law for $\sigma$ takes the following form:
\begin{align}
\frac{1}{E_2}\dot{\sigma} + \frac{1]{\eta}\sigma = \frac{E_2}{\eta}\Delta + \left(\frac{E_1 + E_2}{E_2}\right)\dot{\Delta}
\end{align}
Observe that $\nu\to 0$ yields an elastic foundation; $E_1 = 0$ yields a Maxwell model, while $E_2 \to \infty$ yields a Kelvin-Voigt law. However, in order to preserve the buckling mode for all values of $E_1$ and $E_2$, we must impose that $E_1$ and $E_2$ contribute to the a conserved bulk foundation stiffness. That is, $E_1 + E_2 = Ek_f$, where $E$ is the rod stiffness and $k_f > 0$ quantifies the foundation stiffness. We therefore write $E_1 = (1 - \beta)Ek_f$, $E_2 = \beta Ek_f$, where $\beta \in (0, 1)$.

After non-dimensionalisation, we have the following stress-strain law:
\begin{align}
\dot{\sigma} + \frac{\beta}{\nu}\sigma = k\left(\frac{\beta(1 - \beta)}{\nu}\Delta + \dot{\Delta}\right),
\end{align}
where the dimensionless parameters $\nu$ and $k$ are defined by
\begin{align}
\nu = \frac{\eta}{Ek_f\tau}, \qquad k = \frac{k_fL_0^4}{I}.
\end{align}
The parameter $\nu$ represents the relaxation rate of the foundation stresses in proportion to the foundation stiffness and growth timescale, while $k$ is the re-scaled foundation stiffness. Observe that the special case $\eta = 0$ gives the elastic foundation model. We model the foundation attachment to be unchanging, and given by $\pmb{\rho} = (S_0, 0)$. The linear momentum equations are now given by
\begin{align}
n_x' = \gamma\frac{\sigma}{\Delta}(x - S_0), \qquad n_y' = \gamma\frac{\sigma}{\Delta}y.
\end{align}

### Remodelling foundation
Our final candidate is inspired by a model of seashell evolution (Chirat et al., 2013). Here, we take 
$\sigma = k\Delta$, and model the temporal evolution of $\pmb{\rho}$ by
\begin{align}
\dot{\pmb{\rho}} = \eta(\mathbf{r} - \pmb{\rho}), \qquad \pmb{\rho}(0) = (S_0, 0).
\end{align}
The force balance equations in this case are given by
\begin{align}
&n_x' = k\gamma (x - p_x), \quad\mbox{ where }\quad \dot{p}_x = \eta(x - p_x),\ p_x(0) = S_0;\\
&n_y' = k\gamma (y - p_y), \quad\mbox{ where }\quad \dot{p}_y = \eta(y - p_y), \ p_y(0) = 0.
\end{align}
This law describes the relaxation of the foundation to the current crypt shape, dependent on the relaxation rate $\eta$. As before, setting $\eta = 0$ recovers the elastic foundation model. 

# Results

In all simulations, we set growth to be homogeneous and increasing at a constant rate in time:
\begin{align}
\dot{\gamma} = 1, 
\end{align}
and set the bending stiffness $E_b \equiv 1$ to be spatially homogeneous. The foundation stiffness is set to $k_f = 0.001$, while the cross-section of the rod is assumed to be rectangular, with height $h = 15 \mu\mathrm{m}$ and width $w = 10 \mu\mathrm{m}$, and the dimensional initial rod length is $L_0 = 125\mu\mathrm{m}$.

### No foundation

```{r plot no foundation, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearElasticFoundation/"
values = "Eb_1_kf_0_L0_0p125_homoggrowth"

# Load the solutions
solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
# Load the times
timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))

numSols <- length(solsList[[1]])
solData <- NULL # Create data frame for solutions
solPointData <- NULL

# Some parameters
solCount <- 2
pointCount <- 10

# # Plot solutions
for ( i in seq(2, numSols, solCount) )
{
  # Extract the solution, growth and time
  sol <- solsList[[1]][[i]][[1]]
  currentTime = timesList[[1]][[i]]
  
  # Update the solutions
  solDataFrame <- data.frame(S=sol[2,], x=sol[3,], y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
  solDataFrame$time = toString(currentTime)
  solData <- rbind(solData, solDataFrame)
}

solPlot <- ggplot()
solPlot <- solPlot + geom_path(data=solData, aes(x, -y, color=time), size=0.75)  +  ylab(TeX('$y\\,(\\mu m)$')) +   xlab(TeX('$x\\, (\\mu m)$')) + 
  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(-1.05, 2.05)) + 
  scale_y_continuous(expand = c(0, 0), limits=c(-1.05, 0.05)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount))

solPlot
```

### Elastic foundation 

The elastic foundation case is the simplest because there is no relaxation of neither the stresses nor the foundation shape. Hence, the shape of the rod is completely determined by two parameters in this model, the growth stretch $\gamma$ and the foundation stiffness $k$. Here is a typical growth evolution of the rod shape until self-contact. 

```{r plot elastic foundation kf 0p01, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearElasticFoundation/"
values = "Eb_1_kf_0p01_L0_0p125_homoggrowth"

# Load the solutions
solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
# Load the times
timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))

timeSample = 1.0
finalIndex = match(timeSample, timesList$times)

numSols <- length(solsList[[1]])
solData <- NULL # Create data frame for solutions
solPointData <- NULL

# Some parameters
solCount <- 2

# # Plot solutions
for ( i in seq(2, finalIndex, solCount) )
{
  # Extract the solution, growth and time
  sol <- solsList[[1]][[i]][[1]]
  currentTime = timesList[[1]][[i]]
  
  # Update the solutions
  solDataFrame <- data.frame(S=sol[2,], x=sol[3,], y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
  solDataFrame$time = toString(currentTime)
  solData <- rbind(solData, solDataFrame)
}

solPlot <- ggplot()
solPlot <- solPlot + geom_path(data=solData, aes(x, -y, color=time), size=0.75)  +  ylab(TeX('$y\\,(\\mu m)$')) +   xlab(TeX('$x\\, (\\mu m)$')) + 
  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(-1.05, 2.05)) + 
  scale_y_continuous(expand = c(0, 0), limits=c(-0.8, 0.3)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount))

solPlot
```

We can also plot the horizontal and vertical force components, $n_x$ and $n_y$, and the non-dimensional stress, $\sigma = \Delta$.

```{r plot elastic foundation stress kf 0p01, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearElasticFoundation/"
values = "Eb_1_kf_0p01_L0_0p125_homoggrowth"

# Load the solutions
solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
# Load the times
timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))

numSols <- length(solsList[[1]])
solData <- NULL # Create data frame for solutions
stressData <- NULL

# Some parameters
solCount <- 3

# # Plot solutions
for ( i in seq(3, numSols, solCount) )
{
  # Extract the solution, growth and time
  sol <- solsList[[1]][[i]][[1]]
  currentTime = timesList[[1]][[i]]
  
  # Update the solutions
  solDataFrame <- data.frame(S=sol[2,], x=sol[3,], y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
  solDataFrame$time = toString(currentTime)
  solData <- rbind(solData, solDataFrame)
  
  stressDataFrame <- data.frame(S=sol[1,], nX=sol[5,], nY=sol[6,], n1=sol[6,]*cos(sol[7,])-sol[5,]*sin(sol[7,]), n3=sol[6,]*sin(sol[7,])+sol[5,]*cos(sol[7,]),sigma=sqrt((sol[3,] - sol[2,])^2 + (sol[4,])^2))
  stressDataFrame$time = toString(currentTime)
  stressData <- rbind(stressData, stressDataFrame)
}

solPlotnX <- ggplot() +  geom_path(data=solData, aes(S, nX, color=time), size=0.75)  +  ylab(TeX('$n_x$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotnY <- ggplot() +  geom_path(data=solData, aes(S, -nY, color=time), size=0.75)  +  ylab(TeX('$n_y$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn1 <- ggplot() +  geom_path(data=stressData, aes(S, n1, color=time), size=0.75)  +  ylab(TeX('$n_1$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn3 <- ggplot() +  geom_path(data=stressData, aes(S, n3, color=time), size=0.75)  +  ylab(TeX('$n_3$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

ggarrange(solPlotnX, solPlotnY, solPlotn1, solPlotn3)
```

We see that non-uniformities develop in $n_x$ as $\gamma$ increases, as the post-buckled evolution relieves horizontal compression within the rod. Furthermore, observe that the stress becomes most pronounced at the tip of the invagination. This feature turns out to be common amongst all foundation models explored.

### Viscoelastic foundation

For a Maxwell foundation, we observe that the horizontal forces are effectively uniform for increasing $\gamma$, and the stress is once again most pronounced at the invagination tip. However, we do see that the stress decreases at later times, due to the rapid relaxation of $n_x$.

We first set $\beta = 1$, corresponding to a Maxwell foundation, for comparison with previous literature results. We see that increasing $\nu$ quickens the rate of invagination by the creep, as expected. Interestingly, for values of $\nu \gtrsim 10$, the differences in shape are negligible.

```{r plot SLS foundation kf 0p01 compare nu fixed time beta 1, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"

nuValues <- c("1", "5", "10", "50")
timeSample = 0.9

maxValues = "Eb_1_beta_1_nu_50_kf_0p01_L0_0p125_homoggrowth"
maxTimesList  <- readMat(paste(directory, "times_", maxValues, ".mat", sep=""))
maxNumSols <- length(maxTimesList$times)
maxTime <- maxTimesList$times[maxNumSols]

solCount <- 1
solPlot <- ggplot()

count <- 1
for (i in seq(1, length(nuValues), 1))
{
  nu = nuValues[i]
  
  values = paste("Eb_1_beta_1_nu_", nu, "_kf_0p01_L0_0p125_homoggrowth", sep="")
  
  # Load the solutions
  solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
  # Load the times
  timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
  
  solData <- NULL 
  finalIndex = match(timeSample, timesList$times)
  
  if (i == length(nuValues))
  {
    startIndex <- 2
    solCount <- 2
  }
  else
  {
    startIndex <- 2
    solCount <- 2
  }
  
  for ( j in seq(startIndex, finalIndex, solCount) )
  {
    # Extract the solution, growth and time
    sol <- solsList[[1]][[j]][[1]]
    currentTime <- timesList$times[j]/maxTime
    
    # Update the solutions
    solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
    solDataFrame$time = as.factor(currentTime)
    solData <- rbind(solData, solDataFrame)
    
  }
  
  solPlot <- solPlot + geom_path(data=solData, aes(x, 6 - y, color=time), size=0.75)
  
}

solPlot <- solPlot +  ylab(TeX('$y$')) +   xlab(TeX('$x$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) +
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(9)) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, length(nuValues)*1.5))

solPlot
```


```{r plot SLS foundation kf 0p01 compare nu relaxation beta 1, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"

nuValues <- c("1", "5", "10", "50")
timeSample = 0.9


solCount <- 1
solPlot <- ggplot()

count <- 1
for (i in seq(1, length(nuValues), 1))
{
  nu = nuValues[i]
  
  values = paste("Eb_1_beta_1_nu_", nu, "_kf_0p01_L0_0p125_relaxation", sep="")
  
  # Load the solutions
  solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
  # Load the times
  timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
  
  solData <- NULL 
  finalIndex = length(timesList$newTimes)
  
  if (i == length(nuValues))
  {
    startIndex <- 1
    solCount <- 2
  }
  else
  {
    startIndex <- 1
    solCount <- 2
  }
  
  for ( j in seq(startIndex, finalIndex, solCount) )
  {
    # Extract the solution, growth and time
    sol <- solsList[[1]][[j]][[1]]
    currentTime <- timesList$newTimes[j]/maxTime
    
    # Update the solutions
    solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
    solDataFrame$time = as.factor(currentTime)
    solData <- rbind(solData, solDataFrame)
    
  }
  
  solPlot <- solPlot + geom_path(data=solData, aes(x, 6 - y, color=time), size=0.75)
  
}

solPlot <- solPlot +  ylab(TeX('$y$')) +   xlab(TeX('$x$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) +
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(46)) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, length(nuValues)*1.5))

solPlot
```


```{r plot SLS foundation kf 0p01 compare nu final shape beta 1, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"

nuValues <- c("1", "5", "10", "50")
timeSample = 0.9

maxValues = "Eb_1_beta_1_nu_50_kf_0p01_L0_0p125_homoggrowth"
maxTimesList  <- readMat(paste(directory, "times_", maxValues, ".mat", sep=""))
maxNumSols <- length(maxTimesList$times)
maxTime <- maxTimesList$times[maxNumSols]

solCount <- 1
solPlot <- ggplot()

count <- 1
for (i in seq(1, length(nuValues), 1))
{
  nu = nuValues[i]
  
  values = paste("Eb_1_beta_1_nu_", nu, "_kf_0p01_L0_0p125_homoggrowth", sep="")
  
  # Load the solutions
  solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
  # Load the times
  timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
  
  solData <- NULL 
  finalIndex = length(timesList$times)
  
  if (i == length(nuValues))
  {
    startIndex <- 2
    solCount <- 2
  }
  else
  {
    startIndex <- 2
    solCount <- 2
  }
  
  for ( j in seq(startIndex, finalIndex, solCount) )
  {
    # Extract the solution, growth and time
    sol <- solsList[[1]][[j]][[1]]
    currentTime <- timesList$times[j]/maxTime
    
    # Update the solutions
    solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
    solDataFrame$time = as.factor(currentTime)
    solData <- rbind(solData, solDataFrame)
    
  }
  
  solPlot <- solPlot + geom_path(data=solData, aes(x, 6 - y, color=time), size=0.75)
  
}

solPlot <- solPlot +  ylab(TeX('$y$')) +   xlab(TeX('$x$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) +
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(maxNumSols/solCount)) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, length(nuValues)*1.5))

solPlot
```


```{r plot SLS foundation stress kf 0p01 beta 1 nu 1, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"
values = "Eb_1_beta_1_nu_1_kf_0p01_L0_0p125_homoggrowth"

# Load the solutions
solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
# Load the times
stressesList <- readMat(paste(directory, "stresses_", values, ".mat", sep=""))
# Load the times
timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))

numSols <- length(solsList[[1]])
solData <- NULL # Create data frame for solutions
stressData <- NULL

# Some parameters
solCount <- 2

# # Plot solutions
for ( i in seq(2, numSols, solCount) )
{
  # Extract the solution, growth and time
  sol <- solsList[[1]][[i]][[1]]
  stressSol <- stressesList[[1]][[i]][[1]]
  currentTime = timesList[[1]][[i]]
  
  # Update the solutions
  solDataFrame <- data.frame(S=sol[2,], x=sol[3,], y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
  solDataFrame$time = toString(currentTime)
  solData <- rbind(solData, solDataFrame)
  
  stressDataFrame <- data.frame(S=stressSol[1,], nX=sol[5,], nY=sol[6,], sigma=stressSol[2,], n1=sol[6,]*cos(sol[7,]) - sol[5,]*sin(sol[7,]), n3=sol[5,]*cos(sol[7,]) + sol[6,]*sin(sol[7,]))
  stressDataFrame$time = toString(currentTime)
  stressData <- rbind(stressData, stressDataFrame)
}

solPlotnX <- ggplot() +  geom_path(data=solData, aes(S, nX, color=time), size=0.75)  +  ylab(TeX('$n_x$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotnY <- ggplot() +  geom_path(data=solData, aes(S, -nY, color=time), size=0.75)  +  ylab(TeX('$n_y$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn1 <- ggplot() +  geom_path(data=stressData, aes(S, n1, color=time), size=0.75)  +  ylab(TeX('$n_1$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn3 <- ggplot() +  geom_path(data=stressData, aes(S, n3, color=time), size=0.75)  +  ylab(TeX('$n_3$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotsigma <- ggplot() +  geom_path(data=stressData, aes(S, sigma, color=time), size=0.75)  +  ylab(TeX('$\\sigma$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

ggarrange(solPlotnX, solPlotnY, solPlotn3, solPlotn1)

```

```{r plot SLS foundation stress kf 0p01 beta 1 nu 50, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"
values = "Eb_1_beta_1_nu_50_kf_0p01_L0_0p125_homoggrowth"

# Load the solutions
solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
# Load the times
stressesList <- readMat(paste(directory, "stresses_", values, ".mat", sep=""))
# Load the times
timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))

numSols <- length(solsList[[1]])
solData <- NULL # Create data frame for solutions
stressData <- NULL

# Some parameters
solCount <- 2

# # Plot solutions
for ( i in seq(2, numSols, solCount) )
{
  # Extract the solution, growth and time
  sol <- solsList[[1]][[i]][[1]]
  stressSol <- stressesList[[1]][[i]][[1]]
  currentTime = timesList[[1]][[i]]
  
  # Update the solutions
  solDataFrame <- data.frame(S=sol[2,], x=sol[3,], y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
  solDataFrame$time = toString(currentTime)
  solData <- rbind(solData, solDataFrame)
  
  stressDataFrame <- data.frame(S=stressSol[1,], nX=sol[5,], nY=sol[6,], sigma=stressSol[2,], n1=sol[6,]*cos(sol[7,]) - sol[5,]*sin(sol[7,]), n3=sol[5,]*cos(sol[7,]) + sol[6,]*sin(sol[7,]))
  stressDataFrame$time = toString(currentTime)
  stressData <- rbind(stressData, stressDataFrame)
}

solPlotnX <- ggplot() +  geom_path(data=solData, aes(S, nX, color=time), size=0.75)  +  ylab(TeX('$n_x$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotnY <- ggplot() +  geom_path(data=solData, aes(S, -nY, color=time), size=0.75)  +  ylab(TeX('$n_y$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn1 <- ggplot() +  geom_path(data=stressData, aes(S, n1, color=time), size=0.75)  +  ylab(TeX('$n_1$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn3 <- ggplot() +  geom_path(data=stressData, aes(S, n3, color=time), size=0.75)  +  ylab(TeX('$n_3$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotsigma <- ggplot() +  geom_path(data=stressData, aes(S, sigma, color=time), size=0.75)  +  ylab(TeX('$\\sigma$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

ggarrange(solPlotnX, solPlotnY, solPlotn3, solPlotn1)

```

We now set $\beta = 0.5$, balancing relaxation with creep in the foundation stress constitutive law. 

```{r plot SLS foundation kf 0p01 compare nu fixed time beta 0p5, echo=FALSE, fig.align="center", warning=FALSE}

nuValues <- c("1", "5", "10", "50")
timeSample = 0.9

maxValues = "Eb_1_beta_0p5_nu_50_kf_0p01_L0_0p125_homoggrowth"
maxTimesList  <- readMat(paste(directory, "times_", maxValues, ".mat", sep=""))
maxNumSols <- length(maxTimesList$times)
maxTime <- maxTimesList$times[maxNumSols]

solCount <- 1
solPlot <- ggplot()

for (i in seq(1, length(nuValues), 1))
{
  if (nuValues[i] == "0")
  {
    directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearElasticFoundation/"
    values = "Eb_1_kf_0p01_L0_0p125_homoggrowth"
    
    # Load the solutions
    solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
    # Load the times
    timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
    
    solData <- NULL 
    finalIndex = match(timeSample, timesList$times)
    
    if (i == length(nuValues))
    {
      startIndex <- 2
      solCount <- 2
    }
    else
    {
      startIndex <- 2
      solCount <- 2
    }
    
    for ( j in seq(startIndex, finalIndex, solCount) )
    {
      # Extract the solution, growth and time
      sol <- solsList[[1]][[j]][[1]]
      currentTime <- timesList$times[j]/maxTime
      
      # Update the solutions
      solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
      solDataFrame$time = as.factor(currentTime)
      solData <- rbind(solData, solDataFrame)
      
    }
    
    solPlot <- solPlot + geom_path(data=solData, aes(x, -y, color=time), size=0.75)
  }
  else
  {
    nu = nuValues[i]
    
    directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"
    values = paste("Eb_1_beta_1_nu_", nu, "_kf_0p01_L0_0p125_homoggrowth", sep="")
    
    # Load the solutions
    solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
    # Load the times
    timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
    
    solData <- NULL 
    finalIndex = match(timeSample, timesList$times)
    
    if (i == length(nuValues))
    {
      startIndex <- 2
      solCount <- 2
    }
    else
    {
      startIndex <- 2
      solCount <- 2
    }
    
    for ( j in seq(startIndex, finalIndex, solCount) )
    {
      # Extract the solution, growth and time
      sol <- solsList[[1]][[j]][[1]]
      currentTime <- timesList$times[j]/maxTime
      
      # Update the solutions
      solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
      solDataFrame$time = as.factor(currentTime)
      solData <- rbind(solData, solDataFrame)
      
    }
    
    solPlot <- solPlot + geom_path(data=solData, aes(x, 6 - y, color=time), size=0.75)
    
  }
}

tikz(file = "PlotSLSFoundationBeta0p5FixedTimeVaryingNu.tex", standAlone = T, width = 5, height = 3)
solPlot <- solPlot +  ylab('$y$') +   xlab('$x$') +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) +
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(9)) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, length(nuValues)*1.5))

print(solPlot)
dev.off()

tools::texi2dvi('PlotSLSFoundationBeta0p5FixedTimeVaryingNu.tex', pdf = T, clean = T)
```

```{r plot SLS foundation kf 0p01 compare nu relaxation beta 0p5, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"

nuValues <- c("1", "5", "10", "50")
timeSample = 0.9

solCount <- 1
solPlot <- ggplot()

count <- 1
for (i in seq(1, length(nuValues), 1))
{
  nu = nuValues[i]
  
  values = paste("Eb_1_beta_0p5_nu_", nu, "_kf_0p01_L0_0p125_relaxation", sep="")
  
  # Load the solutions
  solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
  # Load the times
  timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
  
  solData <- NULL 
  finalIndex = length(timesList$newTimes)
  
  if (i == length(nuValues))
  {
    startIndex <- 1
    solCount <- 2
  }
  else
  {
    startIndex <- 1
    solCount <- 2
  }
  
  for ( j in seq(startIndex, finalIndex, solCount) )
  {
    # Extract the solution, growth and time
    sol <- solsList[[1]][[j]][[1]]
    currentTime <- timesList$newTimes[j]/maxTime
    
    # Update the solutions
    solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
    solDataFrame$time = as.factor(currentTime)
    solData <- rbind(solData, solDataFrame)
    
  }
  
  solPlot <- solPlot + geom_path(data=solData, aes(x, 6 - y, color=time), size=0.75)
  
}

tikz(file = "PlotSLSFoundationBeta0p5RelaxationVaryingNu.tex", standAlone = T, width = 5, height = 3)
solPlot <- solPlot +  ylab('$y$') +   xlab('$x$') +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) +
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(46)) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, length(nuValues)*1.5))

print(solPlot)
dev.off()

tools::texi2dvi('PlotSLSFoundationBeta0p5RelaxationVaryingNu.tex', pdf = T, clean = T)
```

```{r plot SLS foundation kf 0p01 compare nu final shape beta 0p5, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"

nuValues <- c("1", "5", "10", "50")
timeSample = 0.9

maxValues = "Eb_1_beta_0p5_nu_50_kf_0p01_L0_0p125_homoggrowth"
maxTimesList  <- readMat(paste(directory, "times_", maxValues, ".mat", sep=""))
maxNumSols <- length(maxTimesList$times)
maxTime <- maxTimesList$times[maxNumSols]

solCount <- 1
solPlot <- ggplot()

count <- 1
for (i in seq(1, length(nuValues), 1))
{
  nu = nuValues[i]
  
  values = paste("Eb_1_beta_0p5_nu_", nu, "_kf_0p01_L0_0p125_homoggrowth", sep="")
  
  # Load the solutions
  solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
  # Load the times
  timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
  
  solData <- NULL 
  finalIndex = length(timesList$times)
  
  if (i == length(nuValues))
  {
    startIndex <- 2
    solCount <- 2
  }
  else
  {
    startIndex <- 2
    solCount <- 2
  }
  
  for ( j in seq(startIndex, finalIndex, solCount) )
  {
    # Extract the solution, growth and time
    sol <- solsList[[1]][[j]][[1]]
    currentTime <- timesList$times[j]/maxTime
    
    # Update the solutions
    solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
    solDataFrame$time = as.factor(currentTime)
    solData <- rbind(solData, solDataFrame)
    
  }
  
  solPlot <- solPlot + geom_path(data=solData, aes(x, 6 - y, color=time), size=0.75)
  
}

tikz(file = "PlotSLSFoundationBeta0p5FinalTimeVaryingNu.tex", standAlone = T, width = 5, height = 3)
solPlot <- solPlot +  ylab('$y$') +   xlab('$x$') +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) +
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(maxNumSols/solCount)) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, length(nuValues)*1.5))

print(solPlot)
dev.off()

tools::texi2dvi('PlotSLSFoundationBeta0p5FinalTimeVaryingNu.tex', pdf = T, clean = T)

```

```{r plot SLS foundation stress kf 0p01 beta 0p5 nu 1, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"
values = "Eb_1_beta_0p5_nu_1_kf_0p01_L0_0p125_homoggrowth"

# Load the solutions
solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
# Load the times
stressesList <- readMat(paste(directory, "stresses_", values, ".mat", sep=""))
# Load the times
timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))

numSols <- length(solsList[[1]])
solData <- NULL # Create data frame for solutions
stressData <- NULL

# Some parameters
solCount <- 2

# # Plot solutions
for ( i in seq(2, numSols, solCount) )
{
  # Extract the solution, growth and time
  sol <- solsList[[1]][[i]][[1]]
  stressSol <- stressesList[[1]][[i]][[1]]
  currentTime = timesList[[1]][[i]]
  
  # Update the solutions
  solDataFrame <- data.frame(S=sol[2,], x=sol[3,], y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
  solDataFrame$time = toString(currentTime)
  solData <- rbind(solData, solDataFrame)
  
  stressDataFrame <- data.frame(S=stressSol[1,], nX=sol[5,], nY=sol[6,], sigma=stressSol[2,], n1=sol[6,]*cos(sol[7,]) - sol[5,]*sin(sol[7,]), n3=sol[5,]*cos(sol[7,]) + sol[6,]*sin(sol[7,]))
  stressDataFrame$time = toString(currentTime)
  stressData <- rbind(stressData, stressDataFrame)
}

solPlotnX <- ggplot() +  geom_path(data=solData, aes(S, nX, color=time), size=0.75)  +  ylab(TeX('$n_x$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotnY <- ggplot() +  geom_path(data=solData, aes(S, -nY, color=time), size=0.75)  +  ylab(TeX('$n_y$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn1 <- ggplot() +  geom_path(data=stressData, aes(S, n1, color=time), size=0.75)  +  ylab(TeX('$n_1$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn3 <- ggplot() +  geom_path(data=stressData, aes(S, n3, color=time), size=0.75)  +  ylab(TeX('$n_3$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotsigma <- ggplot() +  geom_path(data=stressData, aes(S, sigma, color=time), size=0.75)  +  ylab(TeX('$\\sigma$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

ggarrange(solPlotnX, solPlotnY, solPlotn3, solPlotn1)

```

```{r plot SLS foundation stress kf 0p01 beta 0p5 nu 50, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"
values = "Eb_1_beta_0p5_nu_50_kf_0p01_L0_0p125_homoggrowth"

# Load the solutions
solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
# Load the times
stressesList <- readMat(paste(directory, "stresses_", values, ".mat", sep=""))
# Load the times
timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))

numSols <- length(solsList[[1]])
solData <- NULL # Create data frame for solutions
stressData <- NULL

# Some parameters
solCount <- 2

# # Plot solutions
for ( i in seq(2, numSols, solCount) )
{
  # Extract the solution, growth and time
  sol <- solsList[[1]][[i]][[1]]
  stressSol <- stressesList[[1]][[i]][[1]]
  currentTime = timesList[[1]][[i]]
  
  # Update the solutions
  solDataFrame <- data.frame(S=sol[2,], x=sol[3,], y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
  solDataFrame$time = toString(currentTime)
  solData <- rbind(solData, solDataFrame)
  
  stressDataFrame <- data.frame(S=stressSol[1,], nX=sol[5,], nY=sol[6,], sigma=stressSol[2,], n1=sol[6,]*cos(sol[7,]) - sol[5,]*sin(sol[7,]), n3=sol[5,]*cos(sol[7,]) + sol[6,]*sin(sol[7,]))
  stressDataFrame$time = toString(currentTime)
  stressData <- rbind(stressData, stressDataFrame)
}

solPlotnX <- ggplot() +  geom_path(data=solData, aes(S, nX, color=time), size=0.75)  +  ylab(TeX('$n_x$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotnY <- ggplot() +  geom_path(data=solData, aes(S, -nY, color=time), size=0.75)  +  ylab(TeX('$n_y$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn1 <- ggplot() +  geom_path(data=stressData, aes(S, n1, color=time), size=0.75)  +  ylab(TeX('$n_1$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn3 <- ggplot() +  geom_path(data=stressData, aes(S, n3, color=time), size=0.75)  +  ylab(TeX('$n_3$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotsigma <- ggplot() +  geom_path(data=stressData, aes(S, sigma, color=time), size=0.75)  +  ylab(TeX('$\\sigma$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

ggarrange(solPlotnX, solPlotnY, solPlotn3, solPlotn1)

```

### Remodelling foundation

The parameter that is clearly of most interest is the foundation relaxation parameter $\eta$. Here, we plot the final, pre-self-contact shape for various values of $\eta$. Increasing $\eta$ has the two-fold effect of increasing both the invagination length, as well as the bulge width, effectively keeping the aspect ratio constant as $\eta$ increases.

```{r plot remodelling foundation kf 0p01 compare nu fixed time, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/RemodellingFoundation/"

nuValues <- c("1", "5", "10", "50")
timeSample = 1.0

maxValues = "Eb_1_nu_50_kf_0p01_L0_0p125_homoggrowth"
maxTimesList  <- readMat(paste(directory, "times_", maxValues, ".mat", sep=""))
maxNumSols <- length(maxTimesList$times)
maxTime <- maxTimesList$times[maxNumSols]

solCount <- 1
solPlot <- ggplot()

count <- 1
for (i in seq(1, length(nuValues), 1))
{
  if (nuValues[i] == "0")
  {
    directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearElasticFoundation/"
    values = "Eb_1_kf_0p01_L0_0p125_homoggrowth"
    
    # Load the solutions
    solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
    # Load the times
    timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
    
    solData <- NULL 
    finalIndex <- match(timeSample, timesList$times)
    
    startIndex <- 2
    solCount <- 2
    
    for ( j in seq(startIndex, finalIndex, solCount) )
    {
      # Extract the solution, growth and time
      sol <- solsList[[1]][[j]][[1]]
      currentTime <- timesList$times[j]/maxTime
      
      # Update the solutions
      solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
      solDataFrame$time = as.factor(currentTime)
      solData <- rbind(solData, solDataFrame)
      
    }
    
    solPlot <- solPlot + geom_path(data=solData, aes(x, -y, color=time), size=0.75)
    
  }
  else
  {
    directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/RemodellingFoundation/"
    nu = nuValues[i]
    
    values = paste("Eb_1_nu_", nu, "_kf_0p01_L0_0p125_homoggrowth", sep="")
    
    # Load the solutions
    solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
    # Load the times
    timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
    
    solData <- NULL 
    finalIndex <- match(timeSample, timesList$times)
    
    if (i == length(nuValues))
    {
      startIndex <- 5
      solCount <- 9
    }
    else
    {
      startIndex <- 2
      solCount <- 2
    }
    
    for ( j in seq(startIndex, finalIndex, solCount) )
    {
      # Extract the solution, growth and time
      sol <- solsList[[1]][[j]][[1]]
      currentTime <- timesList$times[j]/maxTime
      
      # Update the solutions
      solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
      solDataFrame$time = as.factor(currentTime)
      solData <- rbind(solData, solDataFrame)
      
    }
    
    solPlot <- solPlot + geom_path(data=solData, aes(x, -y, color=time), size=0.75)
  }
  
}

tikz(file = "PlotRemodellingFoundationVaryingEta.tex", standAlone = T, width = 5, height = 3)
solPlot <- solPlot +  ylab('$y$') +   xlab('$x$') +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) +
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(20)) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, length(nuValues)*1.5 + 0.5)) + 
  scale_y_continuous(expand = c(0, 0), limits=c(-0.8, 0.30))

print(solPlot)
dev.off()

tools::texi2dvi('PlotRemodellingFoundationVaryingEta.tex', pdf = T, clean = T)

```

We see that for higher values of $\eta$, the resultant shapes are not too dissimilar at $t = 1.0$. Moreover, once growth is paused and the foundation shapes are allowed to relax, the resultant shape does not vary significantly for $\eta \gtrsim 10$.

```{r plot remodelling foundation kf 0p01 compare nu relaxation, echo=FALSE, fig.align="center", warning=FALSE}

directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/RemodellingFoundation/"

nuValues <- c("1", "5", "10", "50")
timeSample = 1.0

maxValues = "Eb_1_nu_1_kf_0p01_L0_0p125_relaxation"
maxTimesList  <- readMat(paste(directory, "times_", maxValues, ".mat", sep=""))
maxNumSols <- length(maxTimesList$newTimes)
maxTime <- maxTimesList$newTimes[maxNumSols]

solPlot <- ggplot()

for (i in seq(1, length(nuValues), 1))
{
  nu = nuValues[i]
  
  values = paste("Eb_1_nu_", nu, "_kf_0p01_L0_0p125_relaxation", sep="")
  
  # Load the solutions
  solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
  # Load the times
  timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
  
  
  solData <- NULL
  finalIndex = length(timesList$newTimes)
  
  if (i == length(nuValues))
  {
    startIndex <- 2
    solCount <- 2
  }
  else
  {
    startIndex <- 2
    solCount <- 2
  }
  
  for ( j in seq(startIndex, finalIndex, solCount) )
  {
    # Extract the solution, growth and time
    sol <- solsList[[1]][[j]][[1]]
    currentTime <- timesList$newTimes[j]/maxTime
    
    # Update the solutions
    solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
    solDataFrame$time = as.factor(currentTime)
    solData <- rbind(solData, solDataFrame)
    
  }
  
  solPlot <- solPlot + geom_path(data=solData, aes(x, -y, color=time), size=0.75)
  
}

tikz(file = "PlotRemodellingFoundationRelaxationVaryingEta.tex", standAlone = T, width = 5, height = 3)
solPlot <- solPlot +  ylab('$y$') +   xlab('$x$') +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) +
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(58)) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, length(nuValues)*1.5)) + scale_y_continuous(expand = c(0, 0), limits=c(-0.8, 0.3))

print(solPlot)
dev.off()

tools::texi2dvi('PlotRemodellingFoundationRelaxationVaryingEta.tex', pdf = T, clean = T)
```

Of course, it is perhaps the final pre-self-contact shape that is most affected by $\eta$.

```{r plot remodelling foundation kf 0p01 compare nu final shape, echo=FALSE, fig.align="center", warning=FALSE}

nuValues <- c("1", "5", "10", "50")
timeSample = 1.0

maxValues = "Eb_1_nu_50_kf_0p01_L0_0p125_homoggrowth"
maxTimesList  <- readMat(paste(directory, "times_", maxValues, ".mat", sep=""))
maxNumSols <- length(maxTimesList$times)
maxTime <- maxTimesList$times[maxNumSols]

solCount <- 1
solPlot <- ggplot()

count <- 1
for (i in seq(1, length(nuValues), 1))
{
  if (nuValues[i] == "0")
  {
    directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearElasticFoundation/"
    values = "Eb_1_kf_0p01_L0_0p125_homoggrowth"
    
    # Load the solutions
    solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
    # Load the times
    timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
    
    solData <- NULL 
    finalIndex <- length(timesList$times)
    
    startIndex <- 2
    solCount <- 2
    
    for ( j in seq(startIndex, finalIndex, solCount) )
    {
      # Extract the solution, growth and time
      sol <- solsList[[1]][[j]][[1]]
      currentTime <- timesList$times[j]/maxTime
      
      # Update the solutions
      solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
      solDataFrame$time = as.factor(currentTime)
      solData <- rbind(solData, solDataFrame)
      
    }
    
    solPlot <- solPlot + geom_path(data=solData, aes(x, -y, color=time), size=0.75)
  }
  else
  {
    
    nu = nuValues[i]
    
    directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/RemodellingFoundation/"
    values = paste("Eb_1_nu_", nu, "_kf_0p01_L0_0p125_homoggrowth", sep="")
    
    # Load the solutions
    solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
    # Load the times
    timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))
    
    solData <- NULL 
    finalIndex = length(timesList$times)
    
    if (i == length(nuValues))
    {
      startIndex <- 6
      solCount <- 10
    }
    else
    {
      startIndex <- 2
      solCount <- 2
    }
    
    for ( j in seq(startIndex, finalIndex, solCount) )
    {
      # Extract the solution, growth and time
      sol <- solsList[[1]][[j]][[1]]
      currentTime <- timesList$times[j]/maxTime
      
      # Update the solutions
      solDataFrame <- data.frame(S=sol[2,], x=sol[3,] + (i - 1)*1.5, y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
      solDataFrame$time = as.factor(currentTime)
      solData <- rbind(solData, solDataFrame)
      
    }
    
    solPlot <- solPlot + geom_path(data=solData, aes(x, -y, color=time), size=0.75)
  }
  
}

tikz(file = "PlotRemodellingFoundationSelfContactVaryingEta.tex", standAlone = T, width = 5, height = 3)

solPlot <- solPlot +  ylab('$y$') +   xlab('$x$') +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) +
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(maxNumSols/solCount + 2)) +
  scale_x_continuous(expand = c(0, 0), limits=c(0, length(nuValues)*1.5 + 0.5))

print(solPlot)
dev.off()

tools::texi2dvi('PlotRemodellingFoundationSelfContactVaryingEta.tex', pdf = T, clean = T)
```

As expected, the stress profiles for a remodelling foundation are very similar to those for an elastic foundation. A higher value of $\eta$ appears to smooth out the non-uniformities within the stresses. Below, we plot $n_x$, $n_y$, $n_3$ and $n_1$ for $\eta = 1$ and $\eta = 10$, respectively.

```{r plot remodelling foundation stress kf 0p001 nu 1, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/RemodellingFoundation/"
values = "Eb_1_nu_1_kf_0p01_L0_0p125_homoggrowth"

# Load the solutions
solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
# Load the times
timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))

numSols <- length(solsList[[1]])
solData <- NULL # Create data frame for solutions
stressData <- NULL

# Some parameters
solCount <- 3

# # Plot solutions
for ( i in seq(3, numSols, solCount) )
{
  # Extract the solution, growth and time
  sol <- solsList[[1]][[i]][[1]]
  currentTime = timesList[[1]][[i]]
  
  # Update the solutions
  solDataFrame <- data.frame(S=sol[2,], x=sol[3,], y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
  solDataFrame$time = toString(currentTime)
  solData <- rbind(solData, solDataFrame)
  
  stressDataFrame <- data.frame(S=sol[1,], nX=sol[5,], nY=sol[6,], sigma=sqrt((sol[3,] - sol[2,])^2 + (sol[4,])^2), n1=sol[6,]*cos(sol[7,]) - sol[5,]*sin(sol[7,]), n3=sol[5,]*cos(sol[7,]) + sol[6,]*sin(sol[7,]))
  stressDataFrame$time = toString(currentTime)
  stressData <- rbind(stressData, stressDataFrame)
}

solPlotnX <- ggplot() +  geom_path(data=solData, aes(S, nX, color=time), size=0.75)  +  ylab(TeX('$n_x$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05)) 

solPlotnY <- ggplot() +  geom_path(data=solData, aes(S, -nY, color=time), size=0.75)  +  ylab(TeX('$n_y$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotsigma <- ggplot() +  geom_path(data=stressData, aes(S, sigma, color=time), size=0.75)  +  ylab(TeX('$\\sigma$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn1 <- ggplot() +  geom_path(data=stressData, aes(S, n1, color=time), size=0.75)  +  ylab(TeX('$n_1$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn3 <- ggplot() +  geom_path(data=stressData, aes(S, n3, color=time), size=0.75)  +  ylab(TeX('$n_3$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

ggarrange(solPlotnX, solPlotnY, solPlotn3, solPlotn1)
```

As expected, the stress profiles for a remodelling foundation are very similar to those for an elastic foundation, with the stress being most concentrated at the tip of the invagination.

```{r plot remodelling foundation stress kf 0p001 nu 10, echo=FALSE, fig.align="center", warning=FALSE}
directory = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/RemodellingFoundation/"
values = "Eb_1_nu_10_kf_0p01_L0_0p125_homoggrowth"

# Load the solutions
solsList <- readMat(paste(directory, "sols_", values, ".mat", sep=""))
# Load the times
timesList <- readMat(paste(directory, "times_", values, ".mat", sep=""))

numSols <- length(solsList[[1]])
solData <- NULL # Create data frame for solutions
stressData <- NULL

# Some parameters
solCount <- 3

# # Plot solutions
for ( i in seq(3, numSols, solCount) )
{
  # Extract the solution, growth and time
  sol <- solsList[[1]][[i]][[1]]
  currentTime = timesList[[1]][[i]]
  
  # Update the solutions
  solDataFrame <- data.frame(S=sol[2,], x=sol[3,], y=sol[4,], nX=sol[5,], nY=sol[6,], theta=sol[7,], m=sol[8,])
  solDataFrame$time = toString(currentTime)
  solData <- rbind(solData, solDataFrame)
  
  stressDataFrame <- data.frame(S=sol[1,], nX=sol[5,], nY=sol[6,], sigma=sqrt((sol[3,] - sol[2,])^2 + (sol[4,])^2), n1=sol[6,]*cos(sol[7,]) - sol[5,]*sin(sol[7,]), n3=sol[5,]*cos(sol[7,]) + sol[6,]*sin(sol[7,]))
  stressDataFrame$time = toString(currentTime)
  stressData <- rbind(stressData, stressDataFrame)
}

solPlotnX <- ggplot() +  geom_path(data=solData, aes(S, nX, color=time), size=0.75)  +  ylab(TeX('$n_x$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05)) 

solPlotnY <- ggplot() +  geom_path(data=solData, aes(S, -nY, color=time), size=0.75)  +  ylab(TeX('$n_y$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotsigma <- ggplot() +  geom_path(data=stressData, aes(S, sigma, color=time), size=0.75)  +  ylab(TeX('$\\sigma$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn1 <- ggplot() +  geom_path(data=stressData, aes(S, n1, color=time), size=0.75)  +  ylab(TeX('$n_1$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

solPlotn3 <- ggplot() +  geom_path(data=stressData, aes(S, n3, color=time), size=0.75)  +  ylab(TeX('$n_3$')) +   xlab(TeX('$S_0$')) +  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_colour_manual(values=colorRampPalette(brewer.pal(9, "BrBG"))(numSols/solCount)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(0,1.05))

ggarrange(solPlotnX, solPlotnY, solPlotn3, solPlotn1)
```

```{r plot comparison between foundations, echo=FALSE, fig.align="center", warning=FALSE}
directoryElastic = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearElasticFoundation/"
directorySLS = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/LinearViscoelasticFoundation/StandardLinearSolid/"
directoryRemodelling = "~/Documents/MorphoelasticCrypt/MATLAB/Solutions/RemodellingFoundation/"

valuesElastic = "Eb_1_kf_0p01_L0_0p125_homoggrowth"
valuesSLS = "Eb_1_beta_0p5_nu_10_kf_0p01_L0_0p125_homoggrowth"
valuesRemodelling = "Eb_1_nu_10_kf_0p01_L0_0p125_homoggrowth"

# Load the solutions
solsListElastic <- readMat(paste(directoryElastic, "sols_", valuesElastic, ".mat", sep=""))
solsListSLS <- readMat(paste(directorySLS, "sols_", valuesSLS, ".mat", sep=""))
solsListRemodelling <- readMat(paste(directoryRemodelling, "sols_", valuesRemodelling, ".mat", sep=""))

# Load the times
timesListElastic <- readMat(paste(directoryElastic, "times_", valuesElastic, ".mat", sep=""))
timesListSLS <- readMat(paste(directorySLS, "times_", valuesSLS, ".mat", sep=""))
timesListRemodelling <- readMat(paste(directoryRemodelling, "times_", valuesRemodelling, ".mat", sep=""))

timeSample = 1.25
indexElastic = match(timeSample, timesListElastic$times)
indexSLS = match(timeSample, timesListSLS$times)
indexRemodelling = match(timeSample, timesListRemodelling$times)

# Extract the solution, growth and time
solElastic <- solsListElastic[[1]][[indexElastic]][[1]]
solSLS <- solsListSLS[[1]][[indexSLS]][[1]]
solRemodelling <- solsListRemodelling[[1]][[indexSLS]][[1]]


# Update the solutions
solDataElastic <- data.frame(S=solElastic[2,], x=solElastic[3,], y=solElastic[4,])
solDataSLS <- data.frame(S=solSLS[2,], x=solSLS[3,], y=solSLS[4,])
solDataRemodelling <- data.frame(S=solRemodelling[2,], x=solRemodelling[3,], y=solRemodelling[4,])


# Plot the different graphs
solPlot <- ggplot()

solPlot <- solPlot + geom_path(data=solDataElastic, aes(x, -y), size=0.75)  
solPlot <- solPlot + geom_path(data=solDataSLS, aes(x, -y + 6), size=0.75, linetype="dotted")  
solPlot <- solPlot + geom_path(data=solDataRemodelling, aes(x, -y), size=0.75, linetype="dashed")  

tikz(file = "PlotFoundationComparison.tex", standAlone = T, width = 5, height = 4)


solPlot <- solPlot +  ylab('$y$') +   xlab('$x$') + 
  theme(legend.position="none", panel.background = element_blank(), axis.line = element_line(colour = "black"), panel.grid.major = element_blank(), panel.grid.minor = element_blank(), axis.ticks = element_blank(), text=element_text(size=18)) + 
  scale_x_continuous(expand = c(0, 0), limits=c(-0.05, 1.05))


print(solPlot)
dev.off()

tools::texi2dvi('PlotFoundationComparison.tex', pdf = T, clean = T)

```

# Conclusions
Of all the foundation laws considered, the 'plastic' remodelling foundation law appears to have the greatest promise in producing an invagination length akin to that of the crypt (a ratio of up to five-to-one, in terms of length of crypt to width of deformation). However, in the case of homogeneous growth and stiffness, we note that this law maintains a constant aspect ratio for all values of the relaxation parameter $\eta$. Therefore, it makes sense to couple this foundation law with heterogeneities in bending stiffness, say.

One interesting feature that arose out of all foundation models was the concentration of stress at the tip of the invaginations. Specialising this model to that of a crypt, we note that the bending stiffness would be softest in this region of the rod. Furthermore, in the crypt, initial growth is concentrated about the invagination tip, but as the crypt matures in structure, transit-amplifying cells that sit above the crypt base become the dominant driver of cell population. One hypothesis that could be drawn from this is that the mechanical stress that develops at the invagination tip begins to inhibit proliferation in the base, allowing the transit-amplifying cells to continue proliferating while stem cell proliferation slows down. This also may in part explain why a number of stem cells within the base appear to be in a quiescent, 'unlicensed' state (Carroll et al., 2018). This suggests the following, simple mechanochemical law:
\begin{align}
\frac{\dot{\gamma}}{\gamma} = W(s) + \mu(\sigma^* - \sigma),
\end{align}
where $W(s)$ denotes the observable concentration of Wnt signalling (defined with respect to the current arclength parameter $s$).